{"componentChunkName":"component---src-templates-blog-template-js","path":"/ml/cudaInstall","result":{"data":{"markdownRemark":{"html":"<h1>How to install Nvidia Cuda</h1>\n<p>The process to install cuda is quite confusing and all over the place. This guide will help you set up cuda and cudnn on your system (assuming you have an Nvidia GPU) in order to run tensorflow-gpu and actually use the GPU.</p>\n<h2>Pre-reqs</h2>\n<p>As of now, the latest tf is 2.2.0. Tensorflow version 2+ does not work with Cuda 10.2 so you have to install Cuda 10.1 instead. This guide is what has worked for me using Ubuntu 20.04 but it should also work with 18.04 since I followed guides for the that version. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/kraoBlog/static/b94bd4e75c7efdb0dfe4f988f47c89e6/136a2/cudaLinuxKernelSupport.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAABCcAAAQdQGpcXKRAAABkUlEQVQoz4XSx44iUQwF0Pr/n2KBhMQGmpxzRqQhx2ZO1VOzmMW0F5bl5xvsqug7iff7vV6v2+32eDzu9/uDwUBuNputVqvb7dbrdZ3hcNjpdCaTyfdPRL1eL5/PFwoFb9vtdjqdZrPZr59Ip9PFYjGXy2GZzWYmaRwOh0ajARKh96ZbLpcpVKtVXYBKpZLJZFKpVKlUUleTUNRqNdmMfsQnVpqXy+V0Oh2PR+JEGOGQzz9JnM/n3W5H08x+vw+dGMy57uPxuN/v1+t1Pp+vVitgFIvF4na74X29XrIBhaw2H4OdxBBYmBuNRsRlLIpA6qIBqZA144OZoCx/wIgoOy9lfRh9GPkDDkSRCYsxaQ18wGFbjjz9omzO5zX0UYZZLpcoWEDhPIw4pOL5fLoOsFoRg12bc38FCq1JEsEzCnObzSYcGRgLsDFFDAbzqbhiRmuchD5lm/9im6w5343zAHZqzXDz/x3MxOe/ZdXOOgwH5+FgAkb+V5kOGLyz0fEbgTkYZYw22iVhZ9naYXk1j38BdjAFSoYj9r0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cuda Versions\"\n        title=\"Cuda Versions\"\n        src=\"/kraoBlog/static/b94bd4e75c7efdb0dfe4f988f47c89e6/fcda8/cudaLinuxKernelSupport.png\"\n        srcset=\"/kraoBlog/static/b94bd4e75c7efdb0dfe4f988f47c89e6/12f09/cudaLinuxKernelSupport.png 148w,\n/kraoBlog/static/b94bd4e75c7efdb0dfe4f988f47c89e6/e4a3f/cudaLinuxKernelSupport.png 295w,\n/kraoBlog/static/b94bd4e75c7efdb0dfe4f988f47c89e6/fcda8/cudaLinuxKernelSupport.png 590w,\n/kraoBlog/static/b94bd4e75c7efdb0dfe4f988f47c89e6/136a2/cudaLinuxKernelSupport.png 884w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The default GCC and G++ version for Ubuntu 20.04 should be 9.3 or something similar. CuDNN will not make with this version, you can install multiple versions of GCC and using the <code>update-alternatives</code> apt get utility. </p>\n<pre><code>sudo apt install build-essential\nsudo apt -y install gcc-7 g++-7 gcc-8 g++-8 gcc-9 g++-9\n</code></pre>\n<p>After installing several versions of GCC and G++, you can index them using <code>update-alternatives</code> tool like so:</p>\n<pre><code>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 7\nsudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 7\nsudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-8 8\nsudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-8 8\nsudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 9\nsudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 9\n</code></pre>\n<p>You can then switch between the versions using </p>\n<pre><code>sudo update-alternatives --config gcc\n</code></pre>\n<p>which should output something like :</p>\n<pre><code>There are 3 choices for the alternative gcc (providing /usr/bin/gcc).\n\n  Selection    Path            Priority   Status\n------------------------------------------------------------\n  0            /usr/bin/gcc-9   9         auto mode\n* 1            /usr/bin/gcc-7   7         manual mode\n  2            /usr/bin/gcc-8   8         manual mode\n  3            /usr/bin/gcc-9   9         manual mode\n\nPress &#x3C;enter> to keep the current choice[*], or type selection number:\n</code></pre>\n<p>Select 1 since 10.1 requires GCC of less than 8.</p>\n<h2>Cuda 10.1 installation</h2>\n<p>You can follow the official instructions <a href=\"https://docs.nvidia.com/cuda/cuda-installation-guide-linux/\">here</a>. Below are the steps that I followed to get it running on my PC.</p>\n<p>Download the archived 10.1 .deb package <a href=\"https://developer.nvidia.com/cuda-10.1-download-archive-base\">here</a>. Select x86_64 and ubuntu version 18.04. </p>\n<p>To install the deb package:</p>\n<pre><code>sudo dpkg -i cuda-repo-ubuntu1804-10-1-local-10.1.105-418.39_1.0-1_amd64.deb\n\nsudo apt-key add /var/cuda-repo-10-1-local-10.1.105-418.39/7fa2af80.pub\n\nsudo apt-get update\n\nsudo apt-get install cuda\n</code></pre>\n<p>With Cuda installed, you still won't be able to run Tensorflow on the GPU since it also needs CuDNN7.</p>\n<h2>CuDNN 7 installation</h2>\n<p><a href=\"https://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html#installlinux\">Official instructions here</a></p>\n<p>You need an Nvidia Developer account in order to download the runtime and developer libraries.</p>\n<p><a href=\"https://developer.nvidia.com/rdp/cudnn-download\">Download here</a></p>\n<p>Select all three and download:</p>\n<pre><code>cuDNN Runtime Library for Ubuntu18.04 (Deb)\n\ncuDNN Developer Library for Ubuntu18.04 (Deb)\n\ncuDNN Code Samples and User Guide for Ubuntu18.04 (Deb)\n</code></pre>\n<p>With the three .deb packages downloaded, run each of them with dpkg to isntall them:</p>\n<p>The runtime library:\n<code>sudo dpkg -i libcudnn7_7.6.5.32-1+cuda10.2_amd64.deb</code></p>\n<p>The developer library:\n<code>sudo dpkg -i libcudnn7-dev_7.6.5.32-1+cuda10.2_amd64.deb</code></p>\n<p>And optional the code samples. I would suggest do this one as well since you can run one of the samples to verify Cudnn was installed properly:\n<code>sudo dpkg -i libcudnn7-doc_7.6.5.32-1+cuda10.2_amd64.deb</code></p>\n<p>Thats it!</p>\n<h2>Verify installation</h2>\n<p>Straight from the official docs:</p>\n<ol>\n<li>\n<p>Copy the cuDNN sample to a writable path.</p>\n<p><code>cp -r /usr/src/cudnn_samples_v7/ $HOME</code></p>\n</li>\n<li>\n<p>Go to the writable path.</p>\n<p><code>cd $HOME/cudnn_samples_v7/mnistCUDNN</code></p>\n</li>\n<li>\n<p>Compile the mnistCUDNN sample.</p>\n<p><code>make clean &#x26;&#x26; make</code></p>\n</li>\n<li>\n<p>Run the mnistCUDNN sample.</p>\n<p><code>./mnistCUDNN</code></p>\n</li>\n</ol>\n<p>If cuDNN is properly installed and running on your Linux system, you will see a message similar to the following:</p>\n<p><code>Test passed!</code></p>\n<p>If the correct version of GCC is not installed (version 7) the make command will throw a gcc error. See above to install the correct GCC and rerun.</p>\n<p>You can then run the following python in order to verify that tensorflow-gpu is correctly recognizing the GPU:</p>\n<pre><code>import tensorflow as tf\nfrom tensorflow import keras\n\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nprint(tf.__version__)\n\nprint(\"Num GPUs Available: \", len(tf.config.experimental.list_physical_devices('GPU')))\n</code></pre>\n<p>It should output atleast one GPU. My output below:</p>\n<pre><code class=\"language-2.2.0\">2020-05-14 21:59:04.077939: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcuda.so.1\n2020-05-14 21:59:04.117048: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-05-14 21:59:04.117403: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1561] Found device 0 with properties: \npciBusID: 0000:0a:00.0 name: GeForce RTX 2070 SUPER computeCapability: 7.5\ncoreClock: 1.785GHz coreCount: 40 deviceMemorySize: 7.79GiB deviceMemoryBandwidth: 417.29GiB/s\n2020-05-14 21:59:04.118400: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1\n2020-05-14 21:59:04.139527: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10\n2020-05-14 21:59:04.149136: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10\n2020-05-14 21:59:04.151950: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10\n2020-05-14 21:59:04.174307: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10\n2020-05-14 21:59:04.188912: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10\n2020-05-14 21:59:04.227864: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7\n2020-05-14 21:59:04.227984: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-05-14 21:59:04.228512: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-05-14 21:59:04.228943: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1703] Adding visible gpu devices: 0\nNum GPUs Available:  1\n</code></pre>","frontmatter":{"date":"May 14, 2020","path":"/ml/cudaInstall","title":"Speed Challenge from Comma AI"}}},"pageContext":{}}}